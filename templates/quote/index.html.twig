{% extends 'base.html.twig' %}


{% block stylesheets %}
    {{ parent() }}
    
    <style>
        td.details-control {
    background: url('/assets/img/details_open.png') no-repeat center center;
    cursor: pointer;
}

tr.shown td.details-control {
    background: url('/assets/img/details_close.png') no-repeat center center;
}

   td.edit-control {
    background: url('/assets/img/edit.svg') no-repeat center center;
    cursor: pointer;
}

   td.delete-control {
    background: url('/assets/img/delete.png') no-repeat center center;
    cursor: pointer;
}
    </style>

   <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
   <!-- <link href="assets/css/style.css" rel="stylesheet" />-->
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    
    <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>

    <script>
    $(document).ready(function() {
    var table = $('#table').DataTable( {
        "ajax": {
            "url": "quote/json",
            "dataSrc": ""
        },
        "columns": [
             {
                "className":      'details-control',
                "orderable":      false,
                "data":           null,
                "defaultContent": ''
            },
            { "data": "id" },
            { "data": "reference" },
            { "data": "ammount" },
            { "data": "created" },
            {
                "className":      'edit-control',
                "orderable":      false,
                "data":           null,
                "defaultContent": ''
            },
            {
                "className":      'delete-control',
                "orderable":      false,
                "data":           null,
                "defaultContent": ''
            },
            
        ]
    } );
    
    // Add event listener for opening and closing details
    $('#table tbody').on('click', 'td.details-control', function () {
        var tr = $(this).closest('tr');
        var row = table.row( tr );
 
        if ( row.child.isShown() ) {
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            row.child( format(row.data()) ).show();
            tr.addClass('shown');
        }
    } );
    
     // Add event listener for edit
    $('#table tbody').on('click', 'td.edit-control', function () {
        var tr = $(this).closest('tr');
        var data = table.row( tr ).data();
        var id=data['id'];
        
        
       $.get( "quote/edit/"+id, function( data ) {
            $( "#result" ).html( data );
             alert( "Load was performed." );
             });
 
       
    } );
    
    // Add event listener delete
    $('#table tbody').on('click', 'td.delete-control', function () {
        var tr = $(this).closest('tr');
        var row = table.row( tr );
        var data = row.data();
        
            alert( 'You want to delete '+data['id']+'' );
 
       
    } );
      
} );

function format ( d ) {
    // `d` is the original data object for the row
    return ''+d.description;
}
    </script>
{% endblock %}

{% block body %}
    <div>File source at <a href="https://github.com/Atandil/insuracequerydb">https://github.com/Atandil/insuracequerydb</a></div>
    
    <!-- Should be modal -its jusst for demo -->
    <div id="result"></div>
    
    <h1>Quote list <a href="#" id="add">Add new</a></h1>
<table id="table" class="display" style="width:100%">
        <thead>
            <tr> 
                <th> </th>
                <th>Id</th>
                <th>Reference</th>
                <th>Premium Amount</th>
                <th>Created Date</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
      
</table>

{% endblock %}